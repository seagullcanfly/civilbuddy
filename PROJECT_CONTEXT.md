# Civil Buddy - Project Context & Documentation

## Project Overview
**Civil Buddy** is a web application designed to assist Suffolk County Civil Service employees. It provides tools for salary verification, career planning, and visualizing promotional paths.

- **Live Site:** [https://www.civilbuddy.org](https://www.civilbuddy.org)
- **Repo:** `C:\Users\seagu\civilbuddy` (Linked to GitHub)
- **Tech Stack:** React (Vite) + TypeScript + Bootstrap.
- **Hosting:** GitHub Pages.

## Features

### 1. Salary Verification
- **Source:** `src/salaries.json` (Derived from `2024 Salaries - Test.xlsx`).
- **Logic:**
  - Base rates from 2023 Excel sheet.
  - **Global Adjustment:** Applies a `1.025` (2.5%) multiplier to reflect 2024 contract rates.
  - **Differentials:** Evening (6%), Night (10%).
  - **Holidays:** Calculated as `(BiWeekly / 10) * 1.5 * 13 Days`.

### 2. Promotion Calculator
- **Purpose:** Estimates salary upon promotion to a higher grade.
- **Logic:**
  - **3% Rule:** Target salary is `Current Base + 3%`.
  - **Step Projection:** Checks if `Promotion Date` is after July 1st of any year between Today and Promotion. If so, it increments the "Current Step" before calculating the raise.
  - **Result:** Finds the lowest step in the *New Grade* that exceeds the Target.

### 3. Career Map
- **Purpose:** Interactive tree showing "Promotes FROM" and "Promotes TO" for any title.
- **Source:** `src/relationships.json` (Derived from 2,168 `.docx` spec files).
- **Links:** Titles link directly to `apps2.suffolkcountyny.gov/civilservice/specs/{CODE}spe.html`.

## Data Maintenance

### Updating Salaries
1.  Modify `src/salaries.json` directly OR use a Python script to re-parse a new Excel file.
2.  If contract rates change, update `CONTRACT_MULTIPLIER` in `src/pages/SalaryVerification.tsx` and `src/pages/PromotionCalculator.tsx`.

### Updating Specifications (Career Map)
The `relationships.json` file is generated by parsing local `.docx` files.

**How to Update:**
1.  Download fresh specs from Suffolk County to `C:\Users\seagu\Documents\Clean_Specs_Docx`.
2.  Run the extraction script (saved in `scripts/extract_specs.py` or run via CLI).
3.  The script:
    - Reads every `.docx`.
    - Extracts the Title and Spec Code (from filename).
    - Parses the "PROMOTIONAL" section using a regex that handles "status as a..." and "Suffolk County employee..." clauses.
    - Saves to `src/relationships.json`.
4.  Commit and Push to GitHub.

## Scripts
- **`scrape_specs.py`:** A Playwright-based script (located in project root) designed to run on Ubuntu/n8n to scrape the live website if manual downloading becomes tedious.

## Known Logic / Constraints
- **Admin I / II:** The parsing logic has special handling for complex "OR" lists in the Promotional section (e.g. "2 years as X OR 3 years as Y").
- **Formatting:** `formatMoney` handles undefined values safely to prevent crashes on missing data.
- **Missing Titles:** The app filters dropdowns to only show titles where we have **Salary Data**. If a title exists in Specs but not in the Salary Excel, it will be hidden to prevent calculation errors.

## Future Plans
- **Automated Scraping:** Move `scrape_specs.py` to an Ubuntu VPS with `n8n` to auto-update the repo weekly.
- **Education Filter:** The raw `qual_text` is currently extracted. We can add a "Filter by Degree" feature by searching this text.
